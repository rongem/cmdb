<app-help>
    <p i18n="connections rules control, which item types may be connected. Connections are allowed only if a rule explicitely exists">
        Verbindungsregeln steuern, welche Typen von Configuration Items miteinander
        verbunden werden d&uuml;rfen. Nur da, wo explizit eine Regel existiert,
        ist eine Verbindung m&ouml;glich.
    </p>
    <p i18n="together with the feasability of connecting you have to set the maximum number of connections for that rule. You may define 1:1, 1:n or n:m connections. The minimum is always 0, so you don't have to create a connection of that type">
        Neben der reinen M&ouml;glichkeit der Verbindung werden einer Regel auch erlaubte
        Anzahlen von Verbindungen m&ouml;glich. So sind Verbindungen 1:1, 1:n oder n:m denkbar.
        Die jeweils angegebene Zahl stellt dabei die Obergrenze dessen dar, was erlaubt ist.
        Die Untergrenze liegt immer bei 0, d. h. eine Verbindung kann angelegt werden muss
        es aber nicht.
    </p>
</app-help>
<table class="box">
    <thead>
        <tr>
            <th class="table-cell table-header position-relative no-wrap" appClickOpen>
                <button type="button" class="dropdown-toggle">
                    <ng-container i18n="upper item type">
                        Oberer Item-Typ
                    </ng-container>
                    <span>v</span>
                    <span class="visually-hidden" i18n="click to open filter menu">
                        Klicken, um Filtermen&uuml; zu &ouml;ffnen
                    </span>
                </button>
                <ul class="dropdown-menu">
                    <li *ngIf="upperItemTypeId && upperItemTypeId !== 'undefined'">
                        <button type="button" class="red-button" i18n="clear filter" (click)="upperItemTypeId = 'undefined'">
                            Filter l&ouml;schen
                        </button>
                        <hr>
                    </li>
                    <ng-container *ngFor="let itemType of (itemTypes | async)">
                        <li *ngIf="upperItemTypeId !== itemType.id">
                            <button type="button" (click)="upperItemTypeId = itemType.id">
                                {{ itemType.name }}
                            </button>
                        </li>
                    </ng-container>
                </ul>
            </th>
            <th class="table-cell table-header position-relative no-wrap" appClickOpen>
                <button type="button" class="dropdown-toggle">
                    <ng-container i18n="connection type">
                        Verbindungstyp
                    </ng-container>
                    <span>v</span>
                    <span class="visually-hidden" i18n="click to open filter menu">
                        Klicken, um Filtermen&uuml; zu &ouml;ffnen
                    </span>
                </button>
                <ul class="dropdown-menu">
                    <li *ngIf="connectionTypeId && connectionTypeId !== 'undefined'">
                        <button type="button" class="red-button" i18n="clear filter" (click)="connectionTypeId = 'undefined'">
                            Filter l&ouml;schen
                        </button>
                        <hr>
                    </li>
                    <ng-container *ngFor="let connectionType of (connectionTypes | async)">
                        <li *ngIf="connectionTypeId !== connectionType.id">
                            <button type="button" (click)="connectionTypeId = connectionType.id">
                                {{ connectionType.name }} &darr;&nbsp;&uparrow; {{ connectionType.reverseName }}
                            </button>
                        </li>
                    </ng-container>
                </ul>
            </th>
            <th class="table-cell table-header position-relative no-wrap" appClickOpen>
                <button type="button" class="dropdown-toggle">
                    <ng-container i18n="lower item type">
                        Unterer Item-Typ
                    </ng-container>
                    <span>v</span>
                    <span class="visually-hidden" i18n="click to open filter menu">
                        Klicken, um Filtermen&uuml; zu &ouml;ffnen
                    </span>
                </button>
                <ul class="dropdown-menu">
                    <li *ngIf="lowerItemTypeId && lowerItemTypeId !== 'undefined'">
                        <button type="button" class="red-button" i18n="clear filter" (click)="lowerItemTypeId = 'undefined'">
                            Filter l&ouml;schen
                        </button>
                        <hr>
                    </li>
                    <ng-container *ngFor="let itemType of (itemTypes | async)">
                        <li *ngIf="lowerItemTypeId !== itemType.id">
                            <button type="button" (click)="lowerItemTypeId = itemType.id">
                                {{ itemType.name }}
                            </button>
                        </li>
                    </ng-container>
                </ul>
            </th>
            <th class="table-cell table-header" i18n="validation rule for description">
                G&uuml;ltigkeitsregel f&uuml;r Beschreibung:
            </th>
            <th class="table-cell table-header" i18n="connections count for connection rule">
                Anzahl Verbindungen
            </th>
            <th class="table-cell table-header" i18n="commands">Befehle</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let rule of (filteredConnectionRules | async)">
            <td class="table-cell">
                {{ (getItemType(rule.upperItemTypeId) | async)?.name }}
            </td>
            <td class="table-cell rule__connection">
                <span>
                    {{ (getConnectionType(rule.connectionTypeId) | async).name }}
                    (&le; {{ rule.maxConnectionsToLower }})
                </span>
                <span>&darr;&nbsp;&nbsp;&uarr;</span>
                <span>
                    {{ (getConnectionType(rule.connectionTypeId) | async)?.reverseName }}
                    (&le; {{ rule.maxConnectionsToUpper }})
                </span>
            </td>
            <td class="table-cell">
                {{ (getItemType(rule.lowerItemTypeId) | async)?.name }}
            </td>
            <td class="table-cell">
                {{ rule.validationExpression }}
            </td>
            <td class="table-cell">
                {{ (getRulesCount(rule) | async) }}
            </td>
            <td class="table-cell position-relative" appClickOpen>
                <ng-container *ngIf="activeLine === -1 && !createMode">
                    <span class="mobile-only">4: </span>
                    <button type="button" class="dropdown-toggle">
                        ...
                        <span class="visually-hidden" i18n="click to open action menu">
                            Klicken, um Aktionsmen&uuml; zu &ouml;ffnen
                        </span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <button type="button" class="selectable"
                                (click)="onEditRule(rule)">
                                <span i18n="edit connecion rule">Verbindungsregel bearbeiten</span>
                            </button>
                        </li>
                        <li>
                            <button type="button" class="selectable"
                                [cdkCopyToClipboard]="rule.id">
                                <ng-container i18n="Copy Id">Id kopieren</ng-container>
                                <span class="visually-hidden" i18n="click to copy the attribute type id into the clipbaord">
                                    Klicken, um die Id des Attributtyps in die Zwischenablage zu kopieren
                                </span>
                            </button>
                        </li>
                        <li *ngIf="(getRulesCount(rule) | async) === 0">
                            <button type="button" class="red-button selectable"
                                (click)="onDeleteRule(rule)">
                                <ng-container i18n="delete connection rule">Verbindungsregel l&ouml;schen</ng-container>
                            </button>
                        </li>
                    </ul>
                </ng-container>
            </td>
        </tr>
        <tr *ngIf="upperItemTypeId && lowerItemTypeId && connectionTypeId && (filteredConnectionRules | async).length === 0 && upperItemTypeId !== lowerItemTypeId">
            <td class="table-cell" colspan="2">
                <button type="button" class="selectable" (click)="onCreateRule()">
                    <span class="material-icons">add_box</span>
                </button>
            </td>
        </tr>  
    </tbody>
</table>
