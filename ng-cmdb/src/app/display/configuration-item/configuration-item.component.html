<app-busy *ngIf="!(configItemState | async).itemReady" i18n="loading data">
    Lade Daten...
</app-busy>
<ng-container *ngIf="(configItemState | async).itemReady">
    <div class="connections-direction" 
        *ngIf="(configItemState | async).fullConfigurationItem.connectionsToUpper.length > 0">
        <div class="connections-group" 
            *ngFor="let guid of (connectionTypesToUpper | async)">
            <div class="connections-group__container"
                [ngClass]="{ onechild: (getConnectionRuleIdsToUpper(guid) | async).length == 1,
                            twochildren: (getConnectionRuleIdsToUpper(guid) | async).length == 2 }">
                <div class="connections-rule" 
                    *ngFor="let ruleId of (getConnectionRuleIdsToUpper(guid) | async)"
                    [style.background]="getTargetColorByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToUpper)">
                    <em>{{getTargetItemTypeByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToUpper)}}</em>
                    <ul class="connections-rule__container">
                        <li class="connection" 
                            *ngFor="let connection of getConnectionsByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToUpper)">
                            <a [routerLink]="['..', connection.targetId]">
                                {{connection.targetName}}</a>
                            <span *ngIf="connection.description"> ({{connection.description}})</span>
                        </li>
                    </ul>
                </div>
            </div>
            <em>{{(getConnectionType(guid) | async)?.ConnTypeReverseName}}</em>
        </div>
        <div class="connections-arrow">
            <span class="material-icons">arrow_upward</span>
        </div>
    </div>
    <div class="connection-central" [style.background]="(configItemState | async).fullConfigurationItem.color">
        <div class="edit-button" *ngIf="(userRole | async) > 0">
            <a mat-icon-button [routerLink]="['./edit']"
                matTooltip="Configuration Item bearbeiten"
                i18n-matTooltip="edit item">
                <span class="material-icons">edit</span>
            </a>
        </div>
        <div class="label">{{(configItemState | async).fullConfigurationItem.type}}</div>
        <div class="content">{{(configItemState | async).fullConfigurationItem.name}}</div>
        <app-display-item-attributes [attributes]="(configItemState | async).fullConfigurationItem.attributes"></app-display-item-attributes>
        <app-display-item-responsibilities [responsibilities]="(configItemState | async).fullConfigurationItem.responsibilities"
            [mailSubject]="(configItemState | async).fullConfigurationItem.type + ': ' + (configItemState | async).fullConfigurationItem.name">
        </app-display-item-responsibilities>
    </div>
    <div class="connections-direction" *ngIf="(configItemState | async).fullConfigurationItem.connectionsToLower?.length > 0">
        <div class="connections-arrow">
            <span class="material-icons">arrow_downward</span>
        </div>
        <div class="connections-group" 
            *ngFor="let guid of (connectionTypesToLower | async)">
            <em>{{(getConnectionType(guid) | async)?.ConnTypeName}}</em>
            <div class="connections-group__container"
                [ngClass]="{ onechild: (getConnectionRuleIdsToLower(guid) | async).length == 1,
                            twochildren: (getConnectionRuleIdsToLower(guid) | async) == 2 }">
                <div class="connections-rule" 
                    *ngFor="let ruleId of (getConnectionRuleIdsToLower(guid) | async)"
                    [style.background]="getTargetColorByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToLower)">
                    <em>{{getTargetItemTypeByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToLower)}}</em>
                    <ul class="connections-rule__container">
                        <li class="connection" 
                            *ngFor="let connection of getConnectionsByRule(ruleId, (configItemState | async).fullConfigurationItem.connectionsToLower)">
                            <a [routerLink]="['..', connection.targetId]">
                                {{connection.targetName}}</a>
                            <span *ngIf="connection.description"> ({{connection.description}})</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</ng-container>
