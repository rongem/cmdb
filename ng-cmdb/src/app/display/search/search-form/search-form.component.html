<form [formGroup]="searchService.searchForm" (ngSubmit)="onSubmit()"
class="search-form">
  <label for="nameOrValue" i18n="name or attribute value">Name oder Attributwert</label>
  <input id="nameOrValue" type="text" 
      formControlName="NameOrValue"
      placeholder="Item-Name oder Attributwert eingeben"
      i18n-placeholder="please enter item name or attribute value">
  <label for="onlyOwn" *ngIf="searchService.responsibilityEnabled()"
    i18n="Show only onw CIs">Nur eigene CIs anzeigen</label>
  <input type="checkbox" *ngIf="searchService.responsibilityEnabled()" 
      name="onlyOwn" id="onlyOwn" checked="true" (change)="searchService.deleteResponsibility()">
  <input type="hidden" id="responsibleToken" formControlName="ResponsibleToken">
  <label for="itemType" *ngIf="searchService.itemTypeEnabled()" i18n="item type">Item-Typ</label>
  <div class="multivalue-property" *ngIf="searchService.itemTypeEnabled()">
      <input type="hidden" id="itemType" formControlName="ItemType">
      {{searchService.itemTypeName}}
      <button mat-icon-button type="button" (click)="onDeleteItemType()"
        matTooltip="Item-Typ l&ouml;schen" i18n-matTooltip="delete item type">
          <mat-icon>delete_forever</mat-icon>
      </button>
  </div>
  <label *ngIf="searchService.attributesPresent()" i18n="attribute">Attribut</label>
  <div formArrayName="Attributes" *ngIf="searchService.attributesPresent()">
      <div class="attribute-list">
        <ng-container
         *ngFor="let attributeControl of searchService.getAttributeControls(); let i = index"
         [formGroupName]="i">
          <label for="attributType">{{searchService.getAttributeTypeName(attributeControl)}}</label>
          <button mat-icon-button type="button" (click)="onDeleteAttribute(i)"
            matTooltip="Attribut &quot;{{searchService.getAttributeTypeName(attributeControl)}}&quot; l&ouml;schen"
             i18n-matTooltip="delete attribute">
              <mat-icon>delete_forever</mat-icon>
          </button>
          <input type="text" id="{{i}}" formControlName="AttributeValue">
          <input type="hidden" formControlName="AttributeTypeId">
        </ng-container>
      </div>
  </div>
  <label *ngIf="searchService.connectionsToUpperPresent()" 
    i18n="upward connections">Verbindungen nach oben</label>
  <div formArrayName="ConnectionsToUpper" *ngIf="searchService.connectionsToUpperPresent()"
    class="connection-list">
    <ng-container
      *ngFor="let connControl of searchService.getConnectionsToUpperControls(); let i = index"
      [formGroupName]="i">
        <label for="connectionCount">
          {{(metaData | async).connectionTypesMap.get(connControl.get('ConnectionType').value).ConnTypeReverseName}}
        </label>
        <label for="connectionCount">
            {{(metaData | async).itemTypesMap.get(connControl.get('ConfigurationItemType').value).TypeName}}
        </label>
        <button mat-icon-button type="button" (click)="onDeleteConnectionToUpper(i)"
          matTooltip="Verbindung l&ouml;schen"
          i18n-matTooltip="delete connection">
            <mat-icon>delete_forever</mat-icon>
        </button>
        <input type="hidden" formControlName="ConnectionType">
        <input type="hidden" formControlName="ConfigurationItemType">
        <select id="connectionCount" formControlName="Count">
            <option value="0">0</option>
            <option value="1+">> 0</option>
            <option value="1">1</option>
            <option value="2+">> 1</option>
        </select>
    </ng-container>
  </div>
  <label *ngIf="searchService.connectionsToLowerPresent()" i18n="downward connections">Verbindungen nach unten</label>
  <div formArrayName="ConnectionsToLower" *ngIf="searchService.connectionsToLowerPresent()"
    class="connection-list">
    <ng-container
      *ngFor="let connControl of searchService.getConnectionsToLowerControls(); let i = index"
      [formGroupName]="i">
        <label for="connectionCount">
          {{(metaData | async).connectionTypesMap.get(connControl.get('ConnectionType').value).ConnTypeName}}
          {{(metaData | async).itemTypesMap.get(connControl.get('ConfigurationItemType').value).TypeName}}
        </label>
        <button mat-icon-button type="button" (click)="onDeleteConnectionToLower(i)"
          matTooltip="Verbindung l&ouml;schen"
          i18n-matTooltip="delete connection">
            <mat-icon>delete_forever</mat-icon>
        </button>
        <input type="hidden" formControlName="ConnectionType">
        <input type="hidden" formControlName="ConfigurationItemType">
        <select formControlName="Count">
            <option value="0">0</option>
            <option value="1+">> 0</option>
            <option value="1">1</option>
            <option value="2+">> 1</option>
        </select>
    </ng-container>
  </div>
  <div>
      <mat-menu #appMenu="matMenu">
        <button mat-menu-item [matMenuTriggerFor]="attributeTypeMenu"
            [disabled]="!searchService.attributeTypesAvailable()"
            [ngClass]="{vanished: !searchService.attributeTypesAvailable()}"
            type="button" i18n="attribute types">Attribute-Typen
        </button>
        <button mat-menu-item [matMenuTriggerFor]="itemTypeMenu" type="button"
            [disabled]="searchService.itemTypeEnabled()"
            [ngClass]="{vanished: searchService.itemTypeEnabled()}"
            i18n="item types">Item-Typen
        </button>
        <button mat-menu-item [matMenuTriggerFor]="connectionToUpperMenu"
            [disabled]="searchService.connectionTypesToUpper.length == 0"
            [ngClass]="{vanished: searchService.connectionTypesToUpper.length == 0}"
            type="button" i18n="connections to upper item">Verbindungen nach oben
        </button>
        <button mat-menu-item [matMenuTriggerFor]="connectionToLowerMenu"
            [disabled]="searchService.connectionTypesToLower.length == 0"
            [ngClass]="{vanished: searchService.connectionTypesToLower.length == 0}"
            type="button" i18n="connections to lower item">Verbindungen nach unten
        </button>
        <button mat-menu-item type="button" (click)="searchService.addResponsibility()"
            *ngIf="!searchService.responsibilityEnabled()"
            i18n="only own items">Nur eigene Items
        </button>
      </mat-menu>
      <mat-menu #attributeTypeMenu="matMenu">
        <button mat-menu-item type="button"
            *ngFor="let attributeType of searchService.attributeTypes"
            (click)="searchService.addAttributeType(attributeType.TypeId)"
            [disabled]="searchService.selectedAttributeTypes.includes(attributeType.TypeId)"
            [ngClass]="{vanished: searchService.selectedAttributeTypes.includes(attributeType.TypeId)}">
            {{attributeType.TypeName}}
        </button>
      </mat-menu>
      <mat-menu #itemTypeMenu="matMenu">
        <button mat-menu-item type="button" 
            *ngFor="let itemType of searchService.itemTypes"
            (click)="onAddItemType(itemType)">{{itemType.TypeName}}
        </button>
      </mat-menu>
      <mat-menu #connectionToUpperMenu="matMenu">
        <ng-container
          *ngFor="let connectionType of searchService.connectionTypesToUpper">
          <button mat-menu-item type="button" [matMenuTriggerFor]="connectionItemMenu">
            {{connectionType.ConnTypeReverseName}}
          </button>
          <mat-menu #connectionItemMenu="matMenu">
            <button mat-menu-item type="button" i18n="any type"
              [disabled]="searchService.getItemTypesToUpperForConnectionType(connectionType.ConnTypeId).length < 2"
              [ngClass]="{vanished: searchService.getItemTypesToUpperForConnectionType(connectionType.ConnTypeId).length < 2}"
              (click)="searchService.addConnectionToUpper(connectionType.ConnTypeId)">
              beliebigen Typ
            </button>
            <button mat-menu-item type="button" 
              *ngFor="let itemType of searchService.getItemTypesToUpperForConnectionType(connectionType.ConnTypeId)"
              (click)="searchService.addConnectionToUpper(connectionType.ConnTypeId, itemType.TypeId)">
              {{itemType.TypeName}}
            </button>
          </mat-menu>
        </ng-container>
      </mat-menu>
      <mat-menu #connectionToLowerMenu="matMenu">
        <ng-container
          *ngFor="let connectionType of searchService.connectionTypesToLower">
          <button mat-menu-item type="button" [matMenuTriggerFor]="connectionItemMenu">
            {{connectionType.ConnTypeName}}
          </button>
          <mat-menu #connectionItemMenu="matMenu">
            <button mat-menu-item type="button" i18n="any type"
            [disabled]="searchService.getItemTypesToLowerForConnectionType(connectionType.ConnTypeId).length < 2"
            [ngClass]="{vanished: searchService.getItemTypesToLowerForConnectionType(connectionType.ConnTypeId).length < 2}"
            (click)="searchService.addConnectionToLower(connectionType.ConnTypeId)">
              beliebigen Typ
            </button>
            <button mat-menu-item type="button"
              *ngFor="let itemType of searchService.getItemTypesToLowerForConnectionType(connectionType.ConnTypeId)"
              (click)="searchService.addConnectionToLower(connectionType.ConnTypeId, itemType.TypeId)">
              {{itemType.TypeName}}
            </button>
          </mat-menu>
        </ng-container>
      </mat-menu>
      <button mat-icon-button #filterButton [matMenuTriggerFor]="appMenu"
          type="button" matTooltip="Filterkriterien hinzuf&uuml;gen" i18n-matTooltip>
          <mat-icon>filter_list</mat-icon>
      </button>
  </div>
  <div class="submit">
    <button mat-icon-button type="submit" matTooltip="Suche starten" 
        [disabled]="!(searchService.searchForm.touched || searchService.searchForm.dirty) || searchService.searchForm.invalid"
        i18n-matTooltip="start search">
        <mat-icon>search</mat-icon>
    </button>
    <button mat-icon-button type="button" matTooltip="Formular zur&uuml;cksetzen" 
        (click)="onResetForm()" i18n-matToolTip="reset form">
        <mat-icon>delete_forever</mat-icon>
    </button>
  </div>
</form>
